---
import MainLayout from "../layouts/main.astro";
import Sponsors from "./home/Sponsors";
import {
  fetchSponsorsFromContentful,
  fetchSiteImagesFromContentful,
} from "../lib/contentful";

// Partner whitelist: home sponsors + any name containing "e_club_"
const allowedSponsorNames = [
  "sponsor_polihub",
  "sponsor_astra",
  "sponsor_polimi",
];
const allSponsors = await fetchSponsorsFromContentful();
const formatSponsorName = (raw?: string | null) => {
  if (!raw) return "Sponsor";
  const withoutPrefix = raw.replace(/^e_club_/i, "");
  const parts = withoutPrefix.split(/[_\s]+/).filter(Boolean);
  return parts
    .map((p) => p.charAt(0).toUpperCase() + p.slice(1))
    .join(" ")
    .trim();
};
const partnerWhitelist = allSponsors.filter((s) => {
  const name = (s.name ?? "").trim();
  return name.toLowerCase().includes("e_club_");
});

const sponsors = (await fetchSponsorsFromContentful()).filter((s) =>
  allowedSponsorNames.includes((s.name ?? "").trim()),
);

// Hero image from Contentful (key: netwok_hero_image)
const siteImages = await fetchSiteImagesFromContentful();
const heroAsset = siteImages.find(
  (asset) => (asset.key ?? "").toLowerCase() === "netwok_hero_image",
);
const heroLight = heroAsset?.imageLightMode?.url ?? heroAsset?.url ?? undefined;
const heroDark = heroAsset?.imageDarkMode?.url ?? heroLight;
const heroAlt =
  heroAsset?.imageLightMode?.description ??
  heroAsset?.imageLightMode?.title ??
  heroAsset?.imageDarkMode?.description ??
  heroAsset?.imageDarkMode?.title ??
  "Network hero image";
---

<MainLayout>
  <div
    class="min-h-[100svh] md:min-h-screen bg-white dark:bg-gray-900 transition-colors duration-300"
  >
    <!-- Hero Section with Image - Full Screen -->
    <section
      style="background-color: #224371;"
      class="min-h-[100svh] md:min-h-screen flex items-center justify-center px-5 relative pt-28 md:pt-32"
    >
      <div class="max-w-6xl mx-auto w-full">
        <div class="text-center mb-10 md:mb-12 animate-fade-in">
          <h1 class="text-4xl md:text-6xl font-bold text-white mb-4 md:mb-6">
            Our Network
          </h1>
          <p class="text-base md:text-xl text-gray-200 max-w-3xl mx-auto">
            Connecting entrepreneurial minds across Italy and beyond
          </p>
        </div>

        <div
          class="w-full h-[360px] md:h-[520px] rounded-2xl shadow-xl overflow-hidden bg-white/10 backdrop-blur-sm border border-white/20 flex items-center justify-center"
        >
          {
            heroLight ? (
              <picture class="w-full h-full">
                {heroDark && (
                  <source
                    media="(prefers-color-scheme: dark)"
                    srcSet={heroDark}
                  />
                )}
                <img
                  src={heroLight}
                  alt={heroAlt}
                  class="w-full h-full object-cover object-top"
                  loading="lazy"
                />
              </picture>
            ) : (
              <div class="text-center p-8">
                <svg
                  class="w-24 h-24 mx-auto mb-4 text-white/60"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                  />
                </svg>
                <p class="text-white/80 text-lg">Network Image Placeholder</p>
                <p class="text-white/60 text-sm mt-2">
                  Add your network photo here
                </p>
              </div>
            )
          }
        </div>
      </div>

      <!-- Scroll Indicator -->
      <div
        class="absolute bottom-10 left-1/2 transform -translate-x-1/2 flex flex-col items-center gap-2 animate-bounce cursor-pointer"
        onclick="window.scrollTo({ top: window.innerHeight, behavior: 'smooth' })"
      >
        <div
          class="w-6 h-10 border-2 border-white/60 rounded-full flex items-start justify-center p-2"
        >
          <div class="w-1.5 h-3 bg-white/60 rounded-full animate-scroll"></div>
        </div>
        <svg
          class="w-6 h-6 text-white/60"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
        </svg>
      </div>
    </section>

    <!-- Network Logo Section -->
    <section class="py-14 md:py-20 px-4 md:px-5 bg-white dark:bg-gray-900">
      <div class="max-w-6xl mx-auto">
        <h2
          class="text-3xl md:text-5xl font-bold text-gray-900 dark:text-white mb-10 md:mb-12 text-center"
        >
          <div class="flex flex-col items-center">
            <span class="uppercase">E-CLUB</span>
            <span class="flex items-center gap-0 uppercase">
              <span>NETW</span>
              <svg
                class="w-8 h-8 inline-block mx-0.5"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path
                  d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"
                ></path>
              </svg>
              <span>RK</span>
            </span>
          </div>
        </h2>

        <!-- Single Box Container for Partner Whitelist -->
        <div
          class="max-w-5xl mx-auto bg-white dark:bg-gray-800 rounded-2xl p-6 md:p-10 shadow-xl border-4 transition-all duration-300"
          style="border-color: #FC5834;"
        >
          <div
            class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 gap-6 md:gap-10"
          >
            {
              partnerWhitelist.length > 0 ? (
                partnerWhitelist.map((sponsor) => {
                  const logoLight = sponsor.logo?.url ?? undefined;
                  const logoDark = sponsor.logoDark?.url ?? logoLight;
                  const alt =
                    sponsor.logo?.description ??
                    sponsor.logo?.title ??
                    sponsor.logoDark?.description ??
                    sponsor.logoDark?.title ??
                    sponsor.name ??
                    "Sponsor logo";
                  const href = sponsor.url ?? "#";
                  const displayName = formatSponsorName(sponsor.name);

                  return (
                    <a
                      href={href}
                      target={href.startsWith("http") ? "_blank" : undefined}
                      rel={
                        href.startsWith("http")
                          ? "noopener noreferrer"
                          : undefined
                      }
                      class="flex flex-col items-center justify-center transition-all duration-300 hover:scale-105 group text-center space-y-2"
                    >
                      <div class="w-36 h-36 md:w-40 md:h-40 bg-gray-50 dark:bg-gray-700 rounded-xl flex items-center justify-center shadow-md">
                        {logoLight ? (
                          <picture class="w-full flex items-center justify-center px-4 py-2">
                            {logoDark && (
                              <source
                                media="(prefers-color-scheme: dark)"
                                srcSet={logoDark}
                              />
                            )}
                            <img
                              src={logoLight}
                              alt={alt}
                              class="max-h-24 max-w-[180px] md:max-w-[200px] object-contain"
                              loading="lazy"
                            />
                          </picture>
                        ) : (
                          <div class="text-center text-gray-400 group-hover:text-[#FC5834] transition-colors duration-300">
                            <svg
                              class="w-16 h-16 mx-auto mb-2"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                              />
                            </svg>
                            <p class="text-gray-500 text-sm">Logo</p>
                          </div>
                        )}
                      </div>
                      <p class="text-center text-gray-700 dark:text-gray-300 font-semibold text-lg group-hover:text-[#FC5834] transition-colors duration-300">
                        {displayName}
                      </p>
                    </a>
                  );
                })
              ) : (
                <div class="col-span-3 text-center text-gray-500 dark:text-gray-400">
                  No partners found.
                </div>
              )
            }
          </div>
        </div>
      </div>
    </section>

    <!-- About Our Network Section -->
    <section style="background-color: #224371;" class="py-20 px-5">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-4xl md:text-5xl font-bold text-white mb-8 text-center">
          About Our Network
        </h2>
        <div class="prose prose-lg max-w-none">
          <p class="text-xl text-white leading-relaxed mb-8 text-justify">
            The Entrepreneurship Club Network is a community of thinkers and
            doers motivated by the same passion for innovation and disruption.
            Our network of clubs aims at spreading the entrepreneurial spirit
            and supporting students in their entrepreneurial journey by
            connecting and exchanging skills and thoughts. We bring together
            future and established entrepreneurs who strive to make an impact.
            Our work focuses on providing our ecosystem with opportunities for
            connection and ideas contamination. In doing so, we strongly believe
            that expanding and nurturing our network is key to the well-being of
            our mission.
          </p>

          <!-- Quote Staircase Section -->
          <div class="my-12 py-12 px-6">
            <div class="space-y-6 max-w-3xl mx-auto">
              <!-- Step 1 -->
              <div class="flex items-center">
                <div
                  class="w-full md:w-2/3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl px-6 py-4 shadow-lg hover:shadow-xl transition-all duration-300 hover:bg-white/15"
                >
                  <p
                    class="text-lg md:text-xl lg:text-2xl font-semibold text-white italic text-center"
                  >
                    "Coming together is a beginning"
                  </p>
                </div>
              </div>

              <!-- Step 2 -->
              <div class="flex items-center justify-center">
                <div
                  class="w-full md:w-2/3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl px-6 py-4 shadow-lg hover:shadow-xl transition-all duration-300 hover:bg-white/15"
                >
                  <p
                    class="text-lg md:text-xl lg:text-2xl font-semibold text-white italic text-center"
                  >
                    "Staying together is a progress"
                  </p>
                </div>
              </div>

              <!-- Step 3 -->
              <div class="flex items-center justify-end">
                <div
                  class="w-full md:w-2/3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl px-6 py-4 shadow-lg hover:shadow-xl transition-all duration-300 hover:bg-white/15"
                >
                  <p
                    class="text-lg md:text-xl lg:text-2xl font-semibold text-white italic text-center"
                  >
                    "Working together is a success"
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Entrepreneurship Clubs in Italy Section -->
    <section class="py-20 px-5 bg-white dark:bg-gray-900">
      <div class="max-w-4xl mx-auto">
        <h2
          class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-8 text-center"
        >
          Entrepreneurship Clubs in Italy
        </h2>
        <div class="prose prose-lg max-w-none">
          <p
            class="text-base md:text-xl text-gray-700 dark:text-gray-300 leading-relaxed text-justify"
          >
            The first Entrepreneurship Club was founded in 2011 in Bocconi
            University in Milan. The core values (Learn, Network, Build)
            remained present ever since and are everyday refined by our
            experiences. Throughout the years, E-Club Bocconi was able to
            establish strong connections with similar entities around Italy and
            Europe. This international culture characterized the E-Club
            community from day one and mirrors its ambition to expand beyond
            Italian borders. The network was born in 2020 with the establishment
            of the Entrepreneurship Club Polimi at Politecnico di Milano. This
            important step will allow the community to grow further. Thanks to
            motivated actors who share our vision and embrace our values, we are
            helping the spread of the entrepreneurial spirit.
          </p>
        </div>
      </div>
    </section>

    <!-- Sponsors Section (Contentful-synced, partner whitelist) -->
    <Sponsors client:load sponsors={sponsors} />
  </div>

  <style>
    @keyframes scroll {
      0% {
        transform: translateY(0);
        opacity: 1;
      }
      100% {
        transform: translateY(12px);
        opacity: 0;
      }
    }

    .animate-scroll {
      animation: scroll 1.5s ease-in-out infinite;
    }
  </style>
</MainLayout>
