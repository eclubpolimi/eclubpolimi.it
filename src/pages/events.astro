---
import MainLayout from "../layouts/main.astro";
import EventTimeline from "./events/EventTimeline.tsx";
import { fetchEventsFromContentful } from "../lib/contentful";

const rawEvents = await fetchEventsFromContentful();

const events = (rawEvents ?? [])
  .map((item) => {
    const dateObj = item?.date ? new Date(item.date) : null;
    const isValidDate = dateObj && !isNaN(dateObj.getTime());
    const displayDate = isValidDate
      ? dateObj.toLocaleDateString("en-US", {
          month: "long",
          day: "numeric",
          year: "numeric",
        })
      : (item?.date ?? "TBD");

    return {
      title: item?.title ?? "Untitled Event",
      description: item?.description ?? "",
      date: displayDate,
      year: isValidDate ? dateObj.getFullYear() : 0,
      start: item?.date ?? null,
      end: item?.endDate ?? null,
      extendedProps: {
        description: item?.description ?? "",
        location: item?.location ?? "",
      },
    };
  })
  .filter((e) => e.title && e.date && e.description);
---

<MainLayout>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="mt-12">
      <!-- <h2 class="text-2xl font-semibold mb-4">Events Timeline</h2> -->
      <p class="mb-4">
        <!-- To see our full event schedule, check out the <a href="/calendar" class="text-blue-500 hover:underline">E-Club Calendar</a>. -->
      </p>
      <EventTimeline events={events} client:only="react" />
    </div>
  </div>
</MainLayout>
