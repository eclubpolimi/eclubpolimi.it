---
import MainLayout from "../layouts/main.astro";
import EventTimeline from "./events/EventTimeline.tsx";
import { fetchEventsFromContentful } from "../lib/contentful";

const rawEvents = await fetchEventsFromContentful();

const events = (rawEvents ?? [])
  .map((item) => {
    const dateObj = item?.date ? new Date(item.date) : null;
    const isValidDate = dateObj && !isNaN(dateObj.getTime());
    const displayDate = isValidDate
      ? dateObj.toLocaleDateString("en-US", { month: "long", day: "numeric", year: "numeric" })
      : item?.date ?? "TBD";

    return {
      title: item?.title ?? "Untitled Event",
      description: item?.description ?? "",
      date: displayDate,
      year: isValidDate ? dateObj.getFullYear() : 0,
      isoDate: item?.date ?? null,
    };
  })
  .filter((e) => e.title && e.date && e.description);
---

<MainLayout>
  <EventTimeline events={events} client:only="react" />
</MainLayout>
